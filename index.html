<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>シス単 Quiz - 日本語版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #f1f5f9; touch-action: manipulation; }
        .ans-correct { background-color: #10b981 !important; color: white !important; }
        .ans-wrong { background-color: #ef4444 !important; color: white !important; }
        .unknown-btn { background-color: #94a3b8 !important; color: white !important; }
    </style>
</head>
<body>
<div id="app"></div>

<script>
// --- 全単語データ (代表例。実際は2027語すべてここに入ります) ---
const wordData = [
    {id:1, en:"follow", ja:"～に従う"}, {id:2, en:"consider", ja:"～を考慮する"}, 
    // ... (中略：以前の全2027語のリストをここに維持してください) ...
    {id:2027, en:"protocol", ja:"議定書"}
];

const ADMIN_PASS = "Henly0402";
let state = {
    view: 'login',
    currentUser: null,
    users: JSON.parse(localStorage.getItem('sys_users_v4')) || [],
    quiz: null
};

function save() { localStorage.setItem('sys_users_v4', JSON.stringify(state.users)); }

function render() {
    const root = document.getElementById('app');
    
    if (state.view === 'login') {
        root.innerHTML = `
            <div class="min-h-screen flex items-center justify-center p-6">
                <div class="w-full max-w-sm bg-white p-10 rounded-[2.5rem] shadow-xl">
                    <button onclick="adminAuth()" class="text-[10px] text-slate-200 mb-6">管理者用</button>
                    <h2 class="text-2xl font-black text-center mb-10 text-slate-800">ログイン</h2>
                    <input id="uID" type="text" placeholder="ユーザーID" class="w-full p-4 bg-slate-50 rounded-2xl mb-4 outline-none border-2 border-transparent focus:border-blue-500">
                    <input id="uPW" type="password" placeholder="パスワード" class="w-full p-4 bg-slate-50 rounded-2xl mb-8 outline-none border-2 border-transparent focus:border-blue-500">
                    <button onclick="login()" class="w-full py-5 bg-blue-600 text-white rounded-2xl font-bold shadow-lg shadow-blue-100">学習を始める</button>
                </div>
            </div>`;
    }

    else if (state.view === 'home') {
        const u = state.currentUser;
        root.innerHTML = `
            <div class="min-h-screen p-8 max-w-md mx-auto">
                <div class="flex justify-between items-center mb-10">
                    <span class="text-sm font-bold text-slate-400">ID: ${u.id}</span>
                    <button onclick="state.view='login'; render()" class="text-sm text-red-400 font-bold">ログアウト</button>
                </div>
                <h2 class="text-xl font-black mb-6 text-slate-800">コースを選択</h2>
                <div class="space-y-4">
                    <button onclick="selectRange('Basic')" class="w-full py-6 bg-white rounded-3xl font-bold text-slate-700 shadow-sm border border-slate-100">Basic</button>
                    <button onclick="selectRange('Standard')" class="w-full py-6 bg-white rounded-3xl font-bold text-slate-700 shadow-sm border border-slate-100">Standard</button>
                    <button onclick="selectRange('Master')" class="w-full py-10 bg-slate-900 text-white rounded-[2rem] font-black text-xl shadow-xl">Master</button>
                </div>
            </div>`;
    }

    else if (state.view === 'rangeSelect') {
        const type = state.quizType;
        let buttons = "";
        if(type === 'Basic') {
            for(let i=1; i<=400; i+=100) buttons += `<button onclick="startQuiz(${i}, ${i+99})" class="w-full p-6 bg-white rounded-2xl font-bold mb-3 border border-slate-100">${i} ～ ${i+99}</button>`;
        } else if(type === 'Standard') {
            for(let i=401; i<=1200; i+=400) buttons += `<button onclick="startQuiz(${i}, ${i+399})" class="w-full p-6 bg-white rounded-2xl font-bold mb-3 border border-slate-100">${i} ～ ${i+399}</button>`;
        } else {
            root.innerHTML = `
                <div class="min-h-screen p-8 flex flex-col items-center justify-center text-center">
                    <div class="mb-10">
                        <p class="text-slate-400 font-bold mb-2 uppercase tracking-widest text-xs">2000語 到達度</p>
                        <h2 class="text-6xl font-black text-blue-600">${state.currentUser.progress}<span class="text-xl text-slate-400">/2000</span></h2>
                    </div>
                    <button onclick="startQuiz(1, 2027)" class="w-full max-w-xs py-6 bg-blue-600 text-white rounded-3xl font-black text-xl shadow-xl">START</button>
                    <button onclick="state.view='home'; render()" class="mt-8 text-slate-400 font-bold">戻る</button>
                </div>`;
            return;
        }
        root.innerHTML = `<div class="p-8 max-w-md mx-auto"><h2 class="text-xl font-black mb-8">範囲を選択</h2>${buttons}<button onclick="state.view='home'; render()" class="w-full mt-4 text-slate-400 font-bold">戻る</button></div>`;
    }

    else if (state.view === 'test') {
        const q = state.quiz.questions[state.quiz.curr];
        root.innerHTML = `
            <div class="min-h-screen p-6 max-w-md mx-auto bg-white flex flex-col">
                <div class="mt-16 mb-20 text-center flex-1 flex flex-col justify-center">
                    <p class="text-xs text-slate-300 mb-2 font-bold tracking-widest uppercase">No. ${q.id}</p>
                    <h2 class="text-5xl font-black text-slate-800 tracking-tighter">${q.en}</h2>
                </div>
                <div class="grid gap-3 mb-4">
                    ${q.choices.map((c, i) => `<button id="c-${i}" onclick="check(${i})" class="w-full p-5 bg-slate-50 rounded-2xl font-bold text-left border-2 border-transparent active:border-blue-400">${c}</button>`).join('')}
                </div>
                <button onclick="check(-1)" class="w-full p-5 bg-slate-200 text-slate-600 rounded-2xl font-bold mb-10">わからない</button>
            </div>`;
    }

    else if (state.view === 'result') {
        root.innerHTML = `
            <div class="min-h-screen flex flex-col items-center justify-center p-8 text-center bg-white">
                <h2 class="text-2xl font-black mb-2">結果発表</h2>
                <div class="text-7xl font-black text-blue-600 mb-12">${state.quiz.score}<span class="text-2xl text-slate-300">/20</span></div>
                <button onclick="state.view='home'; render()" class="w-full max-w-xs py-5 bg-slate-900 text-white rounded-2xl font-black shadow-xl">ホームに戻る</button>
            </div>`;
    }

    else if (state.view === 'admin') {
        root.innerHTML = `
            <div class="p-8 max-w-md mx-auto">
                <h2 class="text-xl font-black mb-8 uppercase tracking-tighter">管理者設定</h2>
                <div class="bg-white p-6 rounded-3xl shadow-sm mb-8">
                    <p class="text-[10px] font-black text-slate-300 mb-4 uppercase">新規ユーザー追加</p>
                    <input id="nID" type="text" placeholder="ユーザーID" class="w-full p-4 bg-slate-50 rounded-xl mb-2 outline-none">
                    <input id="nPW" type="text" placeholder="パスワード" class="w-full p-4 bg-slate-50 rounded-xl mb-4 outline-none">
                    <button onclick="reg()" class="w-full py-4 bg-blue-600 text-white rounded-xl font-bold">登録する</button>
                </div>
                <div class="bg-white rounded-3xl shadow-sm overflow-hidden">
                    <div class="p-4 bg-slate-50 text-[10px] font-black text-slate-400">登録済みユーザー</div>
                    ${state.users.map(u => `<div class="p-5 border-t flex justify-between font-bold text-slate-700"><span>${u.id}</span><span class="text-blue-500">${u.progress}pt</span></div>`).join('')}
                </div>
                <button onclick="state.view='login'; render()" class="w-full mt-8 text-slate-400 font-bold">終了</button>
            </div>`;
    }
}

// --- アクション ---
function adminAuth() { if (prompt("管理者パスワードを入力") === ADMIN_PASS) { state.view = 'admin'; render(); } }
function reg() {
    const id = document.getElementById('nID').value, pw = document.getElementById('nPW').value;
    if(id && pw) { state.users.push({id, pass:pw, progress:0}); save(); render(); alert("登録しました"); }
}
function login() {
    const id = document.getElementById('uID').value, pw = document.getElementById('uPW').value;
    const u = state.users.find(x => x.id === id && x.pass === pw);
    if(u) { state.currentUser = u; state.view = 'home'; render(); } else { alert("IDまたはパスワードが違います"); }
}
function selectRange(type) { state.quizType = type; state.view = 'rangeSelect'; render(); }
function startQuiz(min, max) {
    let pool = wordData.filter(w => w.id >= min && w.id <= max);
    let qs = [];
    const count = Math.min(pool.length, 20);
    for(let i=0; i<count; i++){
        const t = pool.splice(Math.floor(Math.random()*pool.length), 1)[0];
        let cs = [t.ja];
        while(cs.length < 4){
            let r = wordData[Math.floor(Math.random()*wordData.length)].ja;
            if(!cs.includes(r)) cs.push(r);
        }
        qs.push({...t, choices: cs.sort(() => Math.random()-0.5)});
    }
    state.quiz = { questions: qs, curr: 0, score: 0 };
    state.view = 'test';
    render();
}
function check(idx) {
    const q = state.quiz.questions[state.quiz.curr];
    const ok = (idx !== -1 && q.choices[idx] === q.ja);
    const btns = document.querySelectorAll('.choice-btn');
    
    if(idx === -1) {
        // 「わからない」ボタンが押された場合
    } else {
        document.getElementById(`c-${idx}`).classList.add(ok ? 'ans-correct' : 'ans-wrong');
    }
    
    if(ok) { 
        state.quiz.score++;
        if(state.quizType === 'Master') state.currentUser.progress++;
    }
    save();
    setTimeout(() => {
        if(state.quiz.curr < state.quiz.questions.length - 1) { state.quiz.curr++; render(); }
        else { state.view = 'result'; render(); }
    }, 500);
}

render();
</script>
</body>
</html>
